INTERLIS 2.3;

/* Ortsplanung as national model */
MODEL OrtsplanungV1_1 (en) AT "https://modelbaker.ch" VERSION "2023-03-29" =

  IMPORTS LocalisationCH_V1,GeometryCHLV95_V1;
  DOMAIN
      CHSurface = SURFACE WITH (STRAIGHTS) VERTEX GeometryCHLV95_V1.Coord2 WITHOUT OVERLAPS > 0.001;

  TOPIC Konstruktionen =
    CLASS Gebaeude  =
      Name : MANDATORY TEXT*99;
      Geometrie : MANDATORY OrtsplanungV1_1.CHSurface;
    END Gebaeude;

    CLASS BesitzerIn =
        Vorname : MANDATORY TEXT*99;
        Nachname : MANDATORY TEXT*99;
    END BesitzerIn;

    ASSOCIATION Gebaeude_BesitzerIn =
      BesitzerIn -- {0..1} BesitzerIn;
      Gebaeude -- {0..*} Gebaeude;
    END Gebaeude_BesitzerIn;
  END Konstruktionen;

END OrtsplanungV1_1.

/* Extended Ortsplanung as cantonal model importing national model */
MODEL Kantonale_OrtsplanungV1_1 (en) AT "https://modelbaker.ch" VERSION "2023-03-29" =
  IMPORTS OrtsplanungV1_1;

  TOPIC Konstruktionen EXTENDS OrtsplanungV1_1.Konstruktionen =
    CLASS Gebaeude  (EXTENDED)=
      Beschreibung: TEXT;
      Referenzcode: TEXT;

      !!@ ilivalid.msg = "Beschreibung and/or Referenzcode must be defined."
      SET CONSTRAINT DEFINED (Beschreibung) OR DEFINED (Referenzcode);
    END Gebaeude;
  END Konstruktionen;

END Kantonale_OrtsplanungV1_1.

/* Extended Ortsplanung as city model importing cantonal (and with this the national) model and the national model */
MODEL Staedtische_OrtsplanungV1_1 (en) AT "https://modelbaker.ch" VERSION "2023-03-29" =
  IMPORTS Kantonale_OrtsplanungV1_1, OrtsplanungV1_1;

  !! Freizeit is an extension of the cantonal Konstruktionen (note that there is a constraint there)
  TOPIC Freizeit EXTENDS Kantonale_OrtsplanungV1_1.Konstruktionen =
    OID AS INTERLIS.UUIDOID;

    CLASS Gebaeude (EXTENDED) =
      Unterhaltungsart : TEXT*99;
    END Gebaeude;

  END Freizeit;

  !! Gewerbe is an extension of the cantonal Konstruktionen (note that there is a constraint there)
  TOPIC Gewerbe EXTENDS Kantonale_OrtsplanungV1_1.Konstruktionen =
    OID AS INTERLIS.UUIDOID;

    CLASS Gebaeude (EXTENDED) =
      Firma : TEXT*99;
    END Gebaeude;

  END Gewerbe;

  !! National is an extension of the national Konstruktionen (note that there is NO constraint)
  TOPIC National EXTENDS OrtsplanungV1_1.Konstruktionen =
    OID AS INTERLIS.UUIDOID;

    CLASS Gebaeude (EXTENDED) =
      Bemerkungen: TEXT;
    END Gebaeude;

  END National;

  !! Gebaeude is an extension of the own National (note that here we have our own constraint)
  TOPIC Geheim EXTENDS Staedtische_OrtsplanungV1_1.National =

    CLASS Gebaeude (EXTENDED) =
      isTopSecret: BOOLEAN;
      !!@ ilivalid.msg = "Beschreibung needed when top secret."
      SET CONSTRAINT WHERE isTopSecret:
        DEFINED (Bemerkungen);
    END Gebaeude;

  END Geheim;

END Staedtische_OrtsplanungV1_1.
